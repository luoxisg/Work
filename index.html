<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>项目工作说明</title>
  <style>
    /* 主题色定义 */
    :root {
      --bg: #121212;
      --header-bg: #1F1F1F;
      --card-bg: #1F1F1F;
      --text: #E0E0E0;
      --link: #4FC3F7;
      --nav-bg: #1F1F1F;
      --nav-text: #888888;
      --nav-active: #4FC3F7;
    }

    /* 全局样式 */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
    }
    header {
      background-color: var(--header-bg);
      color: var(--text);
      text-align: center;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      position: relative;
    }
    /* 语言切换按钮 */
    #lang-toggle {
      position: absolute;
      top: 0.75rem;
      right: 1rem;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
    }
    main {
      flex: 1;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      margin-bottom: 56px; /* 为底部导航留空 */
    }
    .card {
      background: var(--card-bg);
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
      transition: transform 0.2s;
      cursor: pointer;
    }
    .card:hover {
      transform: translateY(-2px);
    }
    .card .title {
      display: block;
      padding: 1.25rem;
      color: var(--link);
      font-size: 1.1rem;
      text-decoration: none;
    }
    footer {
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: var(--text);
    }

    /* 项目视图（iframe + 返回） */
    #project-view {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: none;
      flex-direction: column;
      z-index: 900;
    }
    #project-header {
      background: var(--header-bg);
      color: var(--text);
      padding: 0.75rem;
      display: flex;
      align-items: center;
    }
    #project-back {
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      margin-right: 1rem;
    }
    #project-frame {
      flex: 1;
      border: none;
      background: var(--bg);
    }

    /* AI Chatbox */
    #chat-toggle {
      position: fixed;
      bottom: 72px; /* 位于导航上方 */
      right: 1rem;
      width: 56px;
      height: 56px;
      background-color: var(--link);
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-size: 28px;
      z-index: 1000;
    }
    #chat-box {
      position: fixed;
      bottom: 72px;
      right: 1rem;
      width: 300px;
      max-height: 400px;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 1000;
    }
    #chat-header {
      background: var(--header-bg);
      color: var(--text);
      padding: 0.5rem;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #chat-messages {
      flex: 1;
      padding: 0.5rem;
      overflow-y: auto;
      font-size: 0.9rem;
      color: var(--text);
    }
    .msg { margin-bottom: 0.75rem; }
    .msg.user { text-align: right; }
    .bubble {
      display: inline-block;
      padding: 0.5rem;
      border-radius: 12px;
      max-width: 80%;
    }
    .msg.user .bubble { background: var(--link); color: #000; }
    .msg.ai .bubble { background: #333; color: var(--text); }
    #chat-input {
      display: flex;
      border-top: 1px solid #333;
    }
    #chat-input input {
      flex: 1;
      border: none;
      padding: 0.5rem;
      font-size: 0.9rem;
      background: var(--card-bg);
      color: var(--text);
    }
    #chat-input button {
      border: none;
      background: var(--link);
      color: #000;
      padding: 0 1rem;
      cursor: pointer;
    }

    /* 底部导航 */
    #bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 56px;
      background: var(--nav-bg);
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -1px 4px rgba(0,0,0,0.5);
      z-index: 950;
    }
    #bottom-nav a {
      text-align: center;
      font-size: 0.75rem;
      color: var(--nav-text);
      text-decoration: none;
    }
    #bottom-nav a.active {
      color: var(--nav-active);
    }
    #bottom-nav .icon {
      display: block;
      font-size: 1.25rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="header-title">项目工作说明</h1>
    <button id="lang-toggle">EN</button>
  </header>

  <main id="list-view">
    <div class="card" data-url="https://luoxisg.github.io/paint/">
      <span class="title" id="card1">三轴喷绘系统工作说明</span>
    </div>
    <div class="card" data-url="https://luoxisg.github.io/cutting/">
      <span class="title" id="card2">裁切系统工作说明</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/Alboxnew">
      <span class="title" id="card3">Alboxnew 仓库</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/RoboMaster-SDK">
      <span class="title" id="card4">RoboMaster-SDK 仓库</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/xcareBrochure">
      <span class="title" id="card5">xcareBrochure 仓库</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/xcare">
      <span class="title" id="card6">xcare 仓库</span>
    </div>
  </main>

  <footer id="footer-text">© 2025 LuoxiSG</footer>

  <!-- 内嵌项目视图 -->
  <div id="project-view">
    <div id="project-header">
      <button id="project-back">返回</button>
      <span id="project-title"></span>
    </div>
    <iframe id="project-frame"></iframe>
  </div>

  <!-- AI Chatbox -->
  <div id="chat-toggle">💬</div>
  <div id="chat-box">
    <div id="chat-header">
      <span id="chat-header-text">AI 小助手</span>
      <span id="chat-close" style="cursor:pointer;">✖️</span>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input type="text" id="chat-text" placeholder="请输入问题…"/>
      <button id="chat-send">发送</button>
    </div>
  </div>

  <!-- 底部导航 -->
  <nav id="bottom-nav">
    <a href="#" class="nav-item active"><span class="icon">🏠</span>Home</a>
    <a href="#" class="nav-item"><span class="icon">🕒</span>Latest</a>
    <a href="#" class="nav-item"><span class="icon">⭐</span>myST+</a>
    <a href="#" class="nav-item"><span class="icon">📄</span>E-paper</a>
    <a href="#" class="nav-item"><span class="icon">☰</span>Menu</a>
  </nav>

  <script>
    // 文案中英文对照
    const texts = {
      zh: {
        header: "项目工作说明",
        card1: "三轴喷绘系统工作说明",
        card2: "裁切系统工作说明",
        card3: "Alboxnew 仓库",
        card4: "RoboMaster-SDK 仓库",
        card5: "xcareBrochure 仓库",
        card6: "xcare 仓库",
        footer: "© 2025 LuoxiSG",
        chatHeader: "AI 小助手",
        chatPlaceholder: "请输入问题…",
        chatSend: "发送",
        back: "返回"
      },
      en: {
        header: "Project Overview",
        card1: "3-Axis Painting System Docs",
        card2: "Cutting System Docs",
        card3: "Alboxnew Repo",
        card4: "RoboMaster SDK Repo",
        card5: "xcareBrochure Repo",
        card6: "xcare Repo",
        footer: "© 2025 LuoxiSG",
        chatHeader: "AI Assistant",
        chatPlaceholder: "Type your question…",
        chatSend: "Send",
        back: "Back"
      }
    };
    let lang = 'zh';

    // 切换中英文
    document.getElementById('lang-toggle').addEventListener('click', () => {
      lang = (lang === 'zh' ? 'en' : 'zh');
      updateTexts();
      document.getElementById('lang-toggle').textContent = lang === 'zh' ? 'EN' : '中';
    });
    function updateTexts() {
      document.getElementById('header-title').textContent = texts[lang].header;
      for (let i = 1; i <= 6; i++) {
        document.getElementById(`card${i}`).textContent = texts[lang][`card${i}`];
      }
      document.getElementById('footer-text').textContent = texts[lang].footer;
      document.getElementById('chat-header-text').textContent = texts[lang].chatHeader;
      document.getElementById('chat-text').placeholder = texts[lang].chatPlaceholder;
      document.getElementById('chat-send').textContent = texts[lang].chatSend;
      document.getElementById('project-back').textContent = texts[lang].back;
    }

    // 项目内嵌查看 & 退出
    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', () => {
        const url = card.dataset.url;
        const title = card.querySelector('.title').textContent;
        document.getElementById('project-title').textContent = title;
        document.getElementById('project-frame').src = url;
        document.getElementById('list-view').style.display = 'none';
        document.getElementById('project-view').style.display = 'flex';
      });
    });
    document.getElementById('project-back').addEventListener('click', () => {
      document.getElementById('project-frame').src = '';
      document.getElementById('project-view').style.display = 'none';
      document.getElementById('list-view').style.display = 'flex';
    });

    // AI Chatbox
    const toggle = document.getElementById('chat-toggle');
    const box = document.getElementById('chat-box');
    const closeBtn = document.getElementById('chat-close');
    const messages = document.getElementById('chat-messages');
    const input = document.getElementById('chat-text');
    const sendBtn = document.getElementById('chat-send');

    toggle.addEventListener('click', () => box.style.display = 'flex');
    closeBtn.addEventListener('click', () => box.style.display = 'none');
    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      append('user', text);
      input.value = '';
      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({message: text})
        });
        const {reply} = await res.json();
        append('ai', reply);
      } catch {
        append('ai', lang==='zh'?'请求失败，请稍后重试。':'Request failed, please try again.');
      }
    }
    function append(who, txt) {
      const msg = document.createElement('div');
      msg.className = `msg ${who}`;
      const b = document.createElement('div');
      b.className = 'bubble';
      b.textContent = txt;
      msg.appendChild(b);
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    // 初始渲染
    updateTexts();
  </script>
</body>
</html>
