<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é¡¹ç›®å·¥ä½œè¯´æ˜</title>
  <style>
    /* ä¸»é¢˜è‰²å®šä¹‰ */
    :root {
      --bg: #121212;
      --header-bg: #1F1F1F;
      --card-bg: #1F1F1F;
      --text: #E0E0E0;
      --link: #4FC3F7;
      --nav-bg: #1F1F1F;
      --nav-text: #888888;
      --nav-active: #4FC3F7;
    }
    /* å…¨å±€ */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
    }
    header {
      background: var(--header-bg);
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      position: relative;
      text-align: center;
    }
    #header-title {
      margin: 0;
      font-size: 1.5rem;
    }
    #search {
      margin: 0.5rem auto;
      width: 60%;
      max-width: 300px;
      padding: 0.5rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
    }
    #lang-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
    }
    main {
      flex: 1;
      padding: 1rem;
      margin-bottom: 56px;
    }
    /* å¡ç‰‡ */
    .card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--card-bg);
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .card:active {
      background: #2a2a2a;
      transform: translateY(1px);
    }
    .card .icon {
      font-size: 1.2rem;
      padding-left: 1rem;
    }
    .card .title {
      flex: 1;
      padding: 1.25rem 0;
      color: var(--link);
      text-decoration: none;
      font-size: 1.1rem;
    }
    /* ä¸‹è½½æŒ‰é’® */
    #download-section {
      text-align: center;
      margin-bottom: 1rem;
    }
    #download-btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: var(--card-bg);
      border-radius: 8px;
      color: var(--link);
      text-decoration: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
      transition: background 0.2s;
    }
    #download-btn:active { background: #2a2a2a; }
    footer {
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: var(--text);
    }
    /* å†…åµŒè§†å›¾ + éª¨æ¶å± */
    #project-view {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: var(--bg);
      display: none;
      flex-direction: column;
      z-index: 900;
    }
    #project-header {
      background: var(--header-bg);
      color: var(--text);
      padding: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    #project-back {
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
    }
    #breadcrumb {
      font-size: 0.9rem;
    }
    #breadcrumb a {
      color: var(--link);
      text-decoration: none;
    }
    #breadcrumb span {
      margin: 0 0.25rem;
    }
    #skeleton {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #1f1f1f;
      animation: pulse 1.5s infinite;
      z-index: 950;
    }
    @keyframes pulse {
      0%,100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    #project-frame {
      flex: 1;
      border: none;
      background: var(--bg);
    }
    /* AI Chatbox */
    #chat-toggle {
      position: fixed; bottom: 72px; right: 1rem;
      width: 56px; height: 56px;
      background: var(--link); border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; color: #000; cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 1000;
    }
    #chat-box {
      position: fixed; bottom: 72px; right: 1rem;
      width: 300px; max-height: 400px;
      background: var(--card-bg); border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: none; flex-direction: column; overflow: hidden;
      z-index: 1000;
    }
    #chat-header, #chat-input {
      background: var(--header-bg); color: var(--text);
      padding: 0.5rem; display: flex; align-items: center; gap: 0.5rem;
    }
    #chat-messages {
      flex: 1; padding: 0.5rem; overflow-y: auto;
      font-size: 0.9rem; color: var(--text);
    }
    .msg { margin-bottom: 0.75rem; }
    .msg.user { text-align: right; }
    .bubble {
      display: inline-block; padding: 0.5rem;
      border-radius: 12px; max-width: 80%;
    }
    .msg.user .bubble { background: var(--link); color: #000; }
    .msg.ai .bubble { background: #333; color: var(--text); }
    /* åº•éƒ¨å¯¼èˆª */
    #bottom-nav {
      position: fixed; bottom: 0; left: 0;
      width: 100%; height: 56px;
      background: var(--nav-bg);
      display: flex; justify-content: space-around; align-items: center;
      box-shadow: 0 -1px 4px rgba(0,0,0,0.5); z-index: 950;
    }
    #bottom-nav a {
      text-align: center; font-size: 0.75rem;
      color: var(--nav-text); text-decoration: none;
    }
    #bottom-nav a.active { color: var(--nav-active); }
    #bottom-nav .icon {
      display: block; font-size: 1.25rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="header-title">é¡¹ç›®å·¥ä½œè¯´æ˜</h1>
    <input type="text" id="search" placeholder="æœç´¢é¡¹ç›®â€¦"/>
    <button id="lang-toggle">EN</button>
  </header>

  <main id="list-view">
    <div id="download-section">
      <a id="download-btn" href="https://luoxisg.github.io/downloads/lxwork.apk" download>ä¸‹è½½ APK</a>
    </div>
    <div class="card" data-url="https://luoxisg.github.io/paint/">
      <span class="icon">ğŸ“„</span>
      <span class="title" id="card1">ä¸‰è½´å–·ç»˜ç³»ç»Ÿå·¥ä½œè¯´æ˜</span>
    </div>
    <div class="card" data-url="https://luoxisg.github.io/cutting/">
      <span class="icon">âœ‚ï¸</span>
      <span class="title" id="card2">è£åˆ‡ç³»ç»Ÿå·¥ä½œè¯´æ˜</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/Alboxnew">
      <span class="icon">ğŸ™</span>
      <span class="title" id="card3">Alboxnew ä»“åº“</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/RoboMaster-SDK">
      <span class="icon">ğŸ¤–</span>
      <span class="title" id="card4">RoboMaster-SDK ä»“åº“</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/xcareBrochure">
      <span class="icon">ğŸ“˜</span>
      <span class="title" id="card5">xcareBrochure ä»“åº“</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/xcare">
      <span class="icon">ğŸ“—</span>
      <span class="title" id="card6">xcare ä»“åº“</span>
    </div>
    <div class="card" data-url="https://github.com/luoxisg/xstellux">
      <span class="icon">âœ¨</span>
      <span class="title" id="card7">xstellux ä»“åº“</span>
    </div>
  </main>

  <footer id="footer-text">Â© 2025 LuoxiSG</footer>

  <!-- å†…åµŒè§†å›¾ + éª¨æ¶ -->
  <div id="project-view">
    <div id="project-header">
      <button id="project-back">è¿”å›</button>
      <nav id="breadcrumb">
        <a href="#" onclick="backToList()">Home</a>
        <span>/</span>
        <span id="project-title"></span>
      </nav>
    </div>
    <div id="skeleton"></div>
    <iframe id="project-frame"></iframe>
  </div>

  <!-- AI Chatbox -->
  <div id="chat-toggle">ğŸ’¬</div>
  <div id="chat-box">
    <div id="chat-header">
      <span id="chat-header-text">AI å°åŠ©æ‰‹</span>
      <span id="chat-close" style="cursor:pointer;">âœ–ï¸</span>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input type="text" id="chat-text" placeholder="è¯·è¾“å…¥é—®é¢˜â€¦"/>
      <button id="chat-send">å‘é€</button>
    </div>
  </div>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <nav id="bottom-nav">
    <a href="#" class="nav-item active"><span class="icon">ğŸ </span>Home</a>
    <a href="#" class="nav-item"><span class="icon">ğŸ•’</span>Latest</a>
    <a href="#" class="nav-item"><span class="icon">â­</span>myST+</a>
    <a href="#" class="nav-item"><span class="icon">ğŸ“„</span>E-paper</a>
    <a href="#" class="nav-item"><span class="icon">â˜°</span>Menu</a>
  </nav>

  <script>
    // æ–‡æ¡ˆä¸­è‹±æ–‡
    const texts = {
      zh: {
        header: "é¡¹ç›®å·¥ä½œè¯´æ˜",
        placeholder: "æœç´¢é¡¹ç›®â€¦",
        download: "ä¸‹è½½ APK",
        card1: "ä¸‰è½´å–·ç»˜ç³»ç»Ÿå·¥ä½œè¯´æ˜",
        card2: "è£åˆ‡ç³»ç»Ÿå·¥ä½œè¯´æ˜",
        card3: "Alboxnew ä»“åº“",
        card4: "RoboMaster-SDK ä»“åº“",
        card5: "xcareBrochure ä»“åº“",
        card6: "xcare ä»“åº“",
        card7: "xstellux ä»“åº“",
        footer: "Â© 2025 LuoxiSG",
        chatHeader: "AI å°åŠ©æ‰‹",
        chatPlaceholder: "è¯·è¾“å…¥é—®é¢˜â€¦",
        chatSend: "å‘é€",
        back: "è¿”å›"
      },
      en: {
        header: "Project Overview",
        placeholder: "Search projectsâ€¦",
        download: "Download APK",
        card1: "3-Axis Painting System Docs",
        card2: "Cutting System Docs",
        card3: "Alboxnew Repo",
        card4: "RoboMaster SDK Repo",
        card5: "xcareBrochure Repo",
        card6: "xcare Repo",
        card7: "xstellux Repo",
        footer: "Â© 2025 LuoxiSG",
        chatHeader: "AI Assistant",
        chatPlaceholder: "Type your questionâ€¦",
        chatSend: "Send",
        back: "Back"
      }
    };
    let lang = localStorage.getItem('lang') || 'zh';

    // å…ƒç´ 
    const headerTitle = document.getElementById('header-title');
    const searchInput = document.getElementById('search');
    const langToggle = document.getElementById('lang-toggle');
    const downloadBtn = document.getElementById('download-btn');
    const footerText = document.getElementById('footer-text');
    const chatHeader = document.getElementById('chat-header-text');
    const chatText = document.getElementById('chat-text');
    const chatSend = document.getElementById('chat-send');
    const projectBack = document.getElementById('project-back');
    const projectFrame = document.getElementById('project-frame');
    const skeleton = document.getElementById('skeleton');

    function updateTexts() {
      headerTitle.textContent = texts[lang].header;
      searchInput.placeholder = texts[lang].placeholder;
      downloadBtn.textContent = texts[lang].download;
      footerText.textContent = texts[lang].footer;
      chatHeader.textContent = texts[lang].chatHeader;
      chatText.placeholder = texts[lang].chatPlaceholder;
      chatSend.textContent = texts[lang].chatSend;
      projectBack.textContent = texts[lang].back;
      for (let i = 1; i <= 7; i++) {
        document.getElementById(`card${i}`).textContent = texts[lang][`card${i}`];
      }
      langToggle.textContent = lang === 'zh' ? 'EN' : 'ä¸­';
    }

    // è¯­è¨€åˆ‡æ¢
    langToggle.addEventListener('click', () => {
      lang = lang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('lang', lang);
      updateTexts();
    });

    // æœç´¢
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      document.querySelectorAll('.card').forEach(card => {
        const txt = card.querySelector('.title').textContent.toLowerCase();
        card.style.display = txt.includes(q) ? 'flex' : 'none';
      });
    });

    // é¡¹ç›®å†…åµŒ + éª¨æ¶
    function backToList() {
      projectFrame.src = '';
      document.getElementById('project-view').style.display = 'none';
      document.getElementById('list-view').style.display = 'block';
    }
    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('click', () => {
        skeleton.style.display = 'block';
        backToList(); // é‡ç½®è§†å›¾
        const title = card.querySelector('.title').textContent;
        document.getElementById('project-title').textContent = title;
        projectFrame.src = card.dataset.url;
        document.getElementById('list-view').style.display = 'none';
        document.getElementById('project-view').style.display = 'flex';
      });
    });
    projectFrame.addEventListener('load', () => {
      skeleton.style.display = 'none';
    });
    projectBack.addEventListener('click', backToList);

    // AI Chatbox
    const toggle = document.getElementById('chat-toggle');
    const box = document.getElementById('chat-box');
    const closeBtn = document.getElementById('chat-close');
    const messages = document.getElementById('chat-messages');
    const input = document.getElementById('chat-text');
    const sendBtn = document.getElementById('chat-send');

    toggle.addEventListener('click', () => box.style.display = 'flex');
    closeBtn.addEventListener('click', () => box.style.display = 'none');
    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      appendMsg('user', text);
      input.value = '';
      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({message: text})
        });
        const {reply} = await res.json();
        appendMsg('ai', reply);
      } catch {
        appendMsg('ai', lang==='zh'?'è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚':'Request failed.');
      }
    }
    function appendMsg(who, txt) {
      const msg = document.createElement('div');
      msg.className = `msg ${who}`;
      const b = document.createElement('div');
      b.className = 'bubble';
      b.textContent = txt;
      msg.appendChild(b);
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    // åˆå§‹æ¸²æŸ“
    updateTexts();
  </script>
</body>
</html>
